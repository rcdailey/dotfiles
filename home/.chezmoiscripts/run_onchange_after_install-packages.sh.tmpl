#!/usr/bin/env zsh
set -e

# Install packages when Brewfile changes
# Brewfile hash: {{ include "Brewfile.tmpl" | sha256sum }}
# This script runs whenever the Brewfile content changes

# Set Brewfile location using chezmoi template
export HOMEBREW_BUNDLE_FILE="{{ .chezmoi.homeDir }}/Brewfile"

# Check if brew is available
if ! command -v brew &>/dev/null; then
  echo "Error: Homebrew is not installed or not in PATH" >&2
  exit 1
fi

# Check if Brewfile exists
if [[ ! -f "$HOMEBREW_BUNDLE_FILE" ]]; then
  echo "Error: Brewfile not found at $HOMEBREW_BUNDLE_FILE" >&2
  exit 1
fi

# Install all packages from Brewfile
echo "Brewfile changed, installing packages..."
brew bundle --verbose

echo "Package installation complete!"
