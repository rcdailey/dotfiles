#!/usr/bin/env zsh
# Copy Claude Code response containing the search pattern to clipboard

if [[ -z "$1" ]]; then
    echo "Usage: claude-copy 'unique substring from message'" >&2
    return 1
fi

local result
result=$(rg -FIN --no-filename "$1" ~/.claude 2>/dev/null | \
    jq -r 'select(.message.content | type == "array") | .message.content[] | select(.text) | .text' 2>/dev/null)

if [[ -z "$result" ]]; then
    echo "No matching Claude response found" >&2
    return 1
fi

echo "$result" | clip
echo "Copied to clipboard (${#result} chars)"
