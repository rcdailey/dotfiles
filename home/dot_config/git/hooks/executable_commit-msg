#!/bin/sh
# Global commit-msg hook
# Runs commitlint and chains to local hooks

COMMIT_MSG_FILE="$1"

# Run commitlint with explicit config path. Cosmiconfig's global strategy
# uses env-paths which resolves to ~/Library/Preferences/ on macOS instead
# of ~/.config/, so auto-discovery fails to find the XDG config.
if command -v commitlint >/dev/null 2>&1; then
    COMMITLINT_CONFIG="${XDG_CONFIG_HOME:-$HOME/.config}/commitlint/config.mjs"
    if [ -f "$COMMITLINT_CONFIG" ]; then
        commitlint --config "$COMMITLINT_CONFIG" --edit "$COMMIT_MSG_FILE"
    else
        commitlint --edit "$COMMIT_MSG_FILE"
    fi
    RESULT=$?
    if [ $RESULT -ne 0 ]; then
        exit $RESULT
    fi
fi

# Chain to local commit-msg hook if it exists
LOCAL_HOOK="$(git rev-parse --git-dir 2>/dev/null)/hooks/commit-msg"
if [ -x "$LOCAL_HOOK" ]; then
    "$LOCAL_HOOK" "$@"
fi
