#!/bin/sh
# Global commit-msg hook
# Runs commitlint and chains to local hooks

COMMIT_MSG_FILE="$1"

# Run commitlint (cosmiconfig global strategy resolves repo-local config
# first, falling back to ~/.config/commitlint/config.mjs)
if command -v commitlint >/dev/null 2>&1; then
    commitlint --edit "$COMMIT_MSG_FILE"
    RESULT=$?
    if [ $RESULT -ne 0 ]; then
        exit $RESULT
    fi
fi

# Chain to local commit-msg hook if it exists
LOCAL_HOOK="$(git rev-parse --git-dir 2>/dev/null)/hooks/commit-msg"
if [ -x "$LOCAL_HOOK" ]; then
    "$LOCAL_HOOK" "$@"
fi
